{% extends 'accounts/base.html' %}
{% load static %}
{% block content %}
<div class="container mt-5">
    <h1 class="text-center">収支の追加・編集</h1>
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="id_created_at">日付:</label>
            <input type="date" id="id_created_at" name="created_at" class="form-control" required>
        </div>

        <!-- 収入か支出かを選択 -->
        <div class="mb-3">
            <label for="transaction_type" class="form-label">収入/支出<span class="text-danger">*</span></label>
            <select id="transaction_type" name="transaction_type" class="form-select" required>
                <option value="">選択してください</option>
                <option value="income">収入</option>
                <option value="expense">支出</option>
            </select>
        </div>
        
        <!-- カテゴリ選択 -->
        <div class="mb-3">
            <label for="category" class="form-label">カテゴリ<span class="text-danger">*</span></label>
            <select id="category" name="category" class="form-select" required>
                <option value="">収入または支出を選択してください</option>
            </select>
        </div>
        
        <!-- 金額入力 -->
        <div class="mb-3">
            <label for="amount" class="form-label">金額<span class="text-danger">*</span></label>
            <input type="number" id="amount" name="amount" class="form-control" required>
        </div>
        
        <!-- 確定済み/未確定選択 -->
        <div class="mb-3">
            <label for="status" class="form-label">ステータス<span class="text-danger">*</span></label>
            <select id="status" name="status" class="form-select" required>
                <option value="confirmed">確定済み</option>
                <option value="pending">未確定</option>
            </select>
        </div>

        <!-- メモ欄 -->
        <div class="mb-3">
            <label for="memo" class="form-label">メモ</label>
            <textarea id="memo" name="memo" class="form-control" rows="3"></textarea>
        </div>

        <!-- 画像添付機能 -->
        <div class="mb-3">
            <label for="image" class="form-label">画像添付</label>
            <input type="file" id="image" name="image" class="form-control">
        </div>

        <!-- ボタン -->
        <div class="d-flex justify-content-between">
            <button type="submit" class="btn btn-primary">保存</button>
            <a href="{% url 'kakeibo_list' %}" class="btn btn-secondary">戻る</a>
        </div>
    </form>
</div>

<!-- カテゴリ切り替え用JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const transactionTypeSelect = document.getElementById('transaction_type');
    const categorySelect = document.getElementById('category');

    const incomeCategories = [
        '給与', '副収入', '投資収益', '臨時収入', '不労所得', '返金・補助金', 'その他（収入）'
    ];

    const expenseCategories = [
        '住居費', '食費', '光熱費', '通信費', '交通費', '保険料',
        '教育費', '医療費', '娯楽費', '衣服・美容', '交際費',
        '税金・手数料', 'その他（支出）'
    ];

    transactionTypeSelect.addEventListener('change', function() {
        const selectedType = transactionTypeSelect.value;
        categorySelect.innerHTML = '<option value="">選択してください</option>';

        let categories = [];
        if (selectedType === 'income') {
            categories = incomeCategories;
        } else if (selectedType === 'expense') {
            categories = expenseCategories;
        }

        categories.forEach(function(category) {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            categorySelect.appendChild(option);
        });
    });
});
</script>
{% endblock %}